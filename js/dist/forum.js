(()=>{var t={n:n=>{var o=n&&n.__esModule?()=>n.default:()=>n;return t.d(o,{a:o}),o},d:(n,o)=>{for(var e in o)t.o(o,e)&&!t.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:o[e]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n)};(()=>{"use strict";const n=flarum.core.compat["common/app"];t.n(n)().initializers.add("xypp/flarum-answer-bounty",(function(){console.log("[xypp/flarum-answer-bounty] Hello, forum and admin!")}));const o=flarum.core.compat["forum/app"];var e=t.n(o);const r=flarum.core.compat["common/extend"],s=flarum.core.compat["common/utils/classList"];var a=t.n(s);const u=flarum.core.compat["forum/components/DiscussionComposer"];var i=t.n(u);function c(t,n){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},c(t,n)}function l(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,c(t,n)}const p=flarum.core.compat["common/components/Modal"];var y=t.n(p);const f=flarum.core.compat["common/components/Button"];var d=t.n(f);const b=flarum.core.compat["common/utils/Stream"];var v=t.n(b),h=function(t){function n(){for(var n,o=arguments.length,e=new Array(o),r=0;r<o;r++)e[r]=arguments[r];return(n=t.call.apply(t,[this].concat(e))||this).money=void 0,n}l(n,t);var o=n.prototype;return o.oninit=function(n){t.prototype.oninit.call(this,n),this.money=new(v())(this.attrs.current||0)},o.className=function(){return"Modal Modal--small"},o.title=function(){return e().translator.trans("xypp-answer-bounty.forum.modal.title")},o.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",{for:"xypp-bounty-amount"},e().translator.trans("xypp-answer-bounty.forum.modal.label")),m("input",{id:"xypp-bounty-amount",required:!0,className:"FormControl",type:"number",step:"any",min:"1",bidi:this.money})),m("div",{className:"Form-group"},d().component({className:"Button Button--primary",type:"submit"},e().translator.trans("xypp-answer-bounty.forum.modal.submit")),d().component({className:"Button Button--danger",onclick:function(){t.attrs.onselect(null),e().modal.close()}.bind(this)},e().translator.trans("xypp-answer-bounty.forum.modal.clear")))))},o.onsubmit=function(t){t.preventDefault(),this.attrs.onselect(this.money()),e().modal.close()},n}(y());function w(t){return function(){e().modal.show(h,{current:t.composer.fields.bounty||1,onselect:function(n){n?t.composer.fields.bounty=n:delete t.composer.fields.bounty}})}}const x=flarum.core.compat["forum/utils/DiscussionControls"];var B=t.n(x);const g=flarum.core.compat["forum/components/CommentPost"];var N=t.n(g);const _=flarum.core.compat["common/Component"];var O=t.n(_),A=function(t){function n(){return t.apply(this,arguments)||this}return l(n,t),n.prototype.view=function(t){var n=e().forum.attribute("antoinefr-money.moneyname")||"[money]";return m("div",{className:"BountyTip"},m("i",{class:"fas fa-coins"}),e().translator.trans("xypp-answer-bounty.forum.tip",{money:n.replace("[money]",this.attrs.number+""),span:m("span",{className:"BountyTip-number"})}))},n}(O());const C=flarum.core.compat["common/components/Badge"];var j=t.n(C);const M=flarum.core.compat["common/models/Discussion"];var P=t.n(M),k=function(t){function n(){return t.apply(this,arguments)||this}return l(n,t),n.prototype.view=function(t){var n=e().forum.attribute("antoinefr-money.moneyname")||"[money]";return m("span",{className:"BountyBestAns"},m("i",{class:"fas fa-coins"}),e().translator.trans("xypp-answer-bounty.forum.tip-ans",{money:n.replace("[money]",this.attrs.number+""),span:m("span",{className:"BountyTip-number"})}))},n}(O());e().initializers.add("xypp/flarum-answer-bounty",(function(){var t;t=i(),(0,r.extend)(t.prototype,"headerItems",(function(t){var n,o,r;null==(n=this.composer)||null==(n=n.fields)||!n.tags||!this.composer.fields.tags.find((function(t){return t.attribute("isQnA")}))||t.add("bounty",m("a",{className:"ComposerBody-bounty",onclick:w(this)},m("span",{className:a()("BountyLabel",!this.composer.fields.bounty&&"none")},e().translator.trans("xypp-answer-bounty.forum.composer."+(null!=(o=this.composer)&&null!=(o=o.fields)&&o.bounty?"edit":"set"),{bounty:null==(r=this.composer)||null==(r=r.fields)?void 0:r.bounty}))),1)})),(0,r.extend)(t.prototype,"data",(function(t){var n,o;null!=(n=this.composer)&&null!=(n=n.fields)&&n.bounty&&(t.bounty=null==(o=this.composer)||null==(o=o.fields)?void 0:o.bounty)})),(0,r.extend)(B(),"moderationControls",(function(t,n){var o,r=n.user(),s=n.tags(),a=null==(o=e().session)?void 0:o.user,u=!1;!n.attribute("hasBestAnswer")&&s&&s.find((function(t){return t.attribute("isQnA")}))&&(a&&r&&a.id()!==r.id()?n.attribute("xypp-answer-bounty-moderate")&&(u=!0):n.attribute("xypp-answer-bounty-use")&&(u=!0)),u&&t.add("fingerprint-recorder-fingerprint",d().component({icon:"fas fa-users-cog",className:"Button Button--link",onclick:function(){e().modal.show(h,{current:n.attribute("bounty")||1,onselect:function(t){n.save({bounty:t})}})}},e().translator.trans("xypp-answer-bounty.forum.discussion."+(n.attribute("bounty")?"edit":"set"),{bounty:n.attribute("bounty")})))})),(0,r.extend)(N().prototype,"footerItems",(function(t){var n=this.attrs.post,o=n.discussion();!o.hasBestAnswer()&&o.attribute("bounty")&&1===n.number()&&!n.isHidden()&&t.add("bountyTip",m(A,{number:o.attribute("bounty")}),1e5)})),(0,r.extend)(P().prototype,"badges",(function(t){this.attribute("bounty")&&t.add("bounty",j().component({type:"bounty",label:e().translator.trans("xypp-answer-bounty.forum.badge"),icon:"fas fa-coins"}),5)})),(0,r.extend)(flarum.extensions["fof-best-answer"].components.SelectBestAnswerItem.prototype,"items",(function(t){this.discussion.attribute("sent_bounty")&&t.add("sent_bounty",m(k,{number:this.discussion.attribute("sent_bounty")}))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map